---
title: "Mini Project 2"
author: "Talmage Hilton, Gavin Hatch, Ty Hawkes"
date: "`r Sys.Date()`"
output:
  pdf_document:
    latex_engine: xelatex
  html_document:
    df_print: paged
fontsize: 11pt
geometry: margin=1in
header-includes:
- \usepackage{setspace}
- \singlespacing
---


# Intro
Repeated-measures (or longitudinal) data often appears in experimental studies. This type of data is defined as data where multiple observations are collected from the same subject over time.  Because responses within a subject are typically correlated, specifying an appropriate covariance structure is essential for valid inference. In this simulation study, we are interested in comparing the performance of the Likelihood Ratio Test (LRT) and the F-test in detecting differences in slopes between two treatment groups in longitudinal data. We evaluate the Type I error rates and power of both tests for small and large sample sizes under three different covariance structures: compound symmetric, random coefficients, and autoregressive. Our goal is to understand how the choice of covariance structure and estimation method affect the accuracy and power of tests for treatment effects.

In this simulation study, we will see that larger sample sizes and the use of REML lead to the most accurate Type I error rates across all covariance structures. 


# Data Generation
To generate the data, we define three covariance structures that will be used for each subject:

#### 1. Compound Symmetric: 
Assumes constant variance and equal correlation between all observations.

$$
\operatorname{Var}(Y_{ij}) = \sigma^2, \quad \forall i,j
$$

$$
\operatorname{Cov}(Y_{ij}, Y_{ik}) = \rho \sigma^2, \quad \forall i \neq k
$$

#### 2. Random Coefficients: 
Incorporates random intercepts and slopes.


$$
\Sigma = 
\begin{pmatrix}
\sigma_0^2 & \sigma_{01} \\
\sigma_{01} & \sigma_1^2
\end{pmatrix}
$$

$$
\text{Cov}(Y_i) = Z_i 
\begin{pmatrix}
\sigma_0^2 & \sigma_{01} \\
\sigma_{01} & \sigma_1^2
\end{pmatrix}
Z_i' + \sigma^2 I
$$

where

$$
Z_i = 
\begin{pmatrix}
1 & t_{i1} \\
1 & t_{i2} \\
\vdots & \vdots \\
1 & t_{in_i}
\end{pmatrix}
$$

#### 3. Autoregressive: 
Assumes that correlations between observations decrease exponentially with increasing time lag.

$$
\operatorname{Cov}(Y_{ij}, Y_{ik}) = \sigma^2 \rho^{|t_{ij} - t_{ik}|}
$$

We simulate data for two treatment groups (control and treatment). Each subject will have repeated measurements over 5 equally spaced time points. The response variable is generated based on a linear model with fixed effects for time and treatment, as well as random effects according to the specified covariance structure. Specifically, our data can be modeled with the following equation:

$$
Y_{ij} = \beta_0 + \beta_1 \, \text{time}_{ij} \times \text{treatment}_i + \epsilon_{ij},
$$

where 

$$
\boldsymbol{\epsilon}_i = 
\begin{pmatrix}
\epsilon_{i1} \\
\epsilon_{i2} \\
\vdots \\
\epsilon_{in_i}
\end{pmatrix}
\sim N(\mathbf{0}, V),
$$

and \( V \) represents one of the three covariance structures defined above (Compound Symmetric, Random Coefficients, or Autoregressive). 

Each subjectâ€™s repeated measures are thus correlated according to \( V \), while treatment effects are introduced through the fixed effects \( \beta_0 \) and \( \beta_1 \).

To allow accurate comparisons between each dataset, the following constants have been selected that lead to approximately equal generalized variances:


For Compound Symmetry
$$
\sigma^2_{\text{CS}} = 10, \quad \rho = 0.5
$$

For Random Coefficients
$$
\sigma_b^2 = 1, \quad \sigma_c^2 = 1, \quad \sigma_\epsilon^2 = 4.3833424
$$

For Autoregression
$$
\sigma^2_{\text{AR}} = 10, \quad \phi = 0.584776
$$

The generalized variance for each of these is equal to $18,570$.

# Methods
Each dataset was analyzed using models that corresponded to the true covariance structure:

- Compound Symmetric:
Fitted using the generalized least squares (GLS) model with compound symmetric correlation (corCompSymm) via nlme::gls().


- Random Coefficients:
Fitted using a linear mixed-effects model with random intercepts and slopes via lme4::lmer(): $Y \sim 1 + \text{time} + \text{time:group} + (1 + \text{time} \mid \text{id})$

- Autoregressive:
Fitted using GLS with an AR(1) correlation structure (corAR1) via nlme::gls().

For each fitted model, two tests for the treatment-by-time interaction were performed:

- Likelihood Ratio Test (LRT):
Comparing models with and without the interaction term, estimated using maximum likelihood (ML).

- F-test:
Based on approximate denominator degrees of freedom under restricted maximum likelihood (REML).

Across simulations, we computed:

- Type I Error Rate: proportion of rejections when $\beta_1 = 0$

- Power: proportion of rejections when $\beta_1 = 1$


# Results
Type I Error

Our findings show that larger sample sizes and the use of REML lead to the most accurate Type I error rates across all covariance structures. 

[table]
